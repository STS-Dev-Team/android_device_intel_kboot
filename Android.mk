LOCAL_PATH := $(call my-dir)

include $(CLEAR_VARS)
LOCAL_MODULE := busybox
LOCAL_MODULE_TAGS:= eng debug
LOCAL_MODULE_CLASS := EXECUTABLES
LOCAL_MODULE_PATH := $(PRODUCT_OUT)/root/sbin
LOCAL_SRC_FILES := in/$(LOCAL_MODULE)

ifneq ($(TARGET_BUILD_VARIANT),user)
include $(BUILD_PREBUILT)

TOOLS := \
	acpid \
	addgroup \
	adduser \
	adjtimex \
	ar \
	arp \
	arping \
	ash \
	awk \
	basename \
	bbconfig \
	beep \
	blkid \
	brctl \
	bunzip2 \
	bzcat \
	bzip2 \
	cal \
	cat \
	catv \
	chat \
	chattr \
	chgrp \
	chmod \
	chown \
	chpasswd \
	chpst \
	chroot \
	chrt \
	chvt \
	cksum \
	clear \
	cmp \
	comm \
	cp \
	cpio \
	crond \
	cryptpw \
	cttyhack \
	cut \
	date \
	dc \
	dd \
	deallocvt \
	delgroup \
	deluser \
	depmod \
	devmem \
	df \
	dhcprelay \
	diff \
	dirname \
	dmesg \
	dnsd \
	dnsdomainname \
	dos2unix \
	du \
	dumpkmap \
	dumpleases \
	echo \
	ed \
	egrep \
	eject \
	env \
	envdir \
	envuidgid \
	ether-wake \
	expand \
	expr \
	fakeidentd \
	false \
	fbset \
	fbsplash \
	fdflush \
	fdformat \
	fdisk \
	fgrep \
	find \
	findfs \
	flash_eraseall \
	flash_lock \
	flash_unlock \
	flashcp \
	fold \
	free \
	freeramdisk \
	fsck \
	fsck.minix \
	fsync \
	ftpd \
	ftpget \
	ftpput \
	fuser \
	getopt \
	getty \
	grep \
	gunzip \
	gzip \
	halt \
	hd \
	hdparm \
	head \
	hexdump \
	hostid \
	hostname \
	httpd \
	hush \
	hwclock \
	id \
	ifconfig \
	ifdown \
	ifenslave \
	ifplugd \
	ifup \
	inetd \
	init \
	inotifyd \
	install \
	ionice \
	ip \
	ipaddr \
	ipcalc \
	ipcrm \
	ipcs \
	iplink \
	iproute \
	iprule \
	iptunnel \
	kbd_mode \
	kill \
	killall \
	killall5 \
	klogd \
	last \
	length \
	less \
	linux32 \
	linux64 \
	linuxrc \
	ln \
	loadfont \
	loadkmap \
	logger \
	login \
	logname \
	logread \
	losetup \
	lpd \
	lpq \
	lpr \
	ls \
	lsattr \
	lsmod \
	lspci \
	lsusb \
	lzmacat \
	lzop \
	lzopcat \
	makedevs \
	makemime \
	man \
	md5sum \
	mdev \
	mesg \
	microcom \
	mkdir \
	mkdosfs \
	mke2fs \
	mkfifo \
	mkfs.ext2 \
	mkfs.minix \
	mkfs.vfat \
	mknod \
	mkpasswd \
	mkswap \
	mktemp \
	more \
	mount \
	mountpoint \
	msh \
	mt \
	mv \
	nameif \
	nc \
	netstat \
	nice \
	nmeter \
	nohup \
	nslookup \
	ntpd \
	od \
	openvt \
	passwd \
	patch \
	pgrep \
	pidof \
	ping \
	ping6 \
	pipe_progress \
	pivot_root \
	pkill \
	popmaildir \
	poweroff \
	printenv \
	printf \
	ps \
	pscan \
	pwd \
	raidautorun \
	rdate \
	rdev \
	readahead \
	readlink \
	readprofile \
	realpath \
	reformime \
	renice \
	reset \
	resize \
	rm \
	rmdir \
	route \
	rtcwake \
	runsv \
	runsvdir \
	rx \
	script \
	scriptreplay \
	sed \
	sendmail \
	seq \
	setarch \
	setconsole \
	setfont \
	setkeycodes \
	setlogcons \
	setsid \
	setuidgid \
	sh \
	sha1sum \
	sha256sum \
	sha512sum \
	showkey \
	slattach \
	sleep \
	softlimit \
	sort \
	split \
	stat \
	strings \
	stty \
	su \
	sulogin \
	sum \
	sv \
	svlogd \
	swapoff \
	swapon \
	switch_root \
	sync \
	sysctl \
	syslogd \
	tac \
	tail \
	tar \
	taskset \
	tcpsvd \
	tee \
	telnet \
	telnetd \
	test \
	tftp \
	tftpd \
	time \
	timeout \
	top \
	touch \
	tr \
	traceroute \
	traceroute6 \
	true \
	tty \
	ttysize \
	tunctl \
	tune2fs \
	udhcpc \
	udhcpd \
	udpsvd \
	umount \
	uname \
	uncompress \
	unexpand \
	uniq \
	unix2dos \
	unlzma \
	unlzop \
	unzip \
	uptime \
	usleep \
	uudecode \
	uuencode \
	vconfig \
	vi \
	vlock \
	volname \
	wall \
	watch \
	watchdog \
	wc \
	wget \
	which \
	who \
	whoami \
	xargs \
	yes \
	[ \
	[[ \
	zcat

SYMLINKS := $(addprefix $(PRODUCT_OUT)/root/sbin/,$(TOOLS))
$(SYMLINKS): BUSYBOX_BINARY := $(LOCAL_MODULE)
$(SYMLINKS): $(LOCAL_INSTALLED_MODULE) $(LOCAL_PATH)/Android.mk
	@echo "Symlink: $@ -> $(BUSYBOX_BINARY)"
	@mkdir -p $(dir $@)
	@rm -rf $@
	$(hide) ln -sf $(BUSYBOX_BINARY) $@

ALL_DEFAULT_INSTALLED_MODULES += $(SYMLINKS)

# We need this so that the installed files could be picked up based on the
# local module name
ALL_MODULES.$(LOCAL_MODULE).INSTALLED := \
	$(ALL_MODULES.$(LOCAL_MODULE).INSTALLED) $(SYMLINKS)
endif

include	$(LOCAL_PATH)/flash_stitched/Android.mk

.PHONY: kboot
kboot: 
	device/intel/kboot/kboot-build-all.sh $(TARGET_PRODUCT)

